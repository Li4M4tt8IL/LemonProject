package me.pm.lemon.module.modules.exploits;

import com.google.common.collect.Sets;
import me.pm.lemon.event.EventTarget;
import me.pm.lemon.event.events.TickEvent;
import me.pm.lemon.gui.clickGui.settings.*;
import me.pm.lemon.module.Category;
import me.pm.lemon.module.Module;
import me.pm.lemon.utils.generalUtils.FabricReflect;
import net.minecraft.item.Item;
import net.minecraft.item.Items;

import java.awt.*;
import java.util.Set;

public class FastUse extends Module {

    private static final Set<Item> THROWABLE = Sets.newHashSet(
            Items.SNOWBALL, Items.EGG, Items.EXPERIENCE_BOTTLE,
            Items.ENDER_EYE, Items.ENDER_PEARL, Items.SPLASH_POTION, Items.LINGERING_POTION);

    public FastUse(String name, Category category, String description, int keyCode, Color color) {
        super(name, category, description, keyCode, color,
                new SettingMode("Mode", "Single", "Multi"),
                new SettingSlider("Multi", 1, 100, 20, 0),
                new SettingToggle("Throwables Only", true),
                new SettingToggle("XP Only", false));
    }


    @EventTarget
    public void onTick(TickEvent event) {
        if ((getSetting(2).asToggle().state && !THROWABLE.contains(mc.player.getMainHandStack().getItem()))
                || (getSetting(3).asToggle().state && mc.player.getMainHandStack().getItem() != Items.EXPERIENCE_BOTTLE)) {
            return;
        }

        /* set rightClickDelay to 0 */
        FabricReflect.writeField(mc, 0, "field_1752", "itemUseCooldown");

        /* call rightClickMouse */
        if (getSetting(0).asMode().mode == 1 && mc.options.keyUse.isPressed()) {
            for (int i = 0; i < (int) getSetting(1).asSlider().getValue(); i++) {
                FabricReflect.invokeMethod(mc, "method_1583", "doItemUse");
            }
        }
    }
}